(()=>{class e{constructor(){this.form=document.getElementById("giftForm"),this.loadingSection=document.getElementById("loadingSection"),this.resultsSection=document.getElementById("resultsSection"),this.giftsContainer=document.getElementById("giftsContainer"),this.resultsCount=document.getElementById("resultsCount"),this.newSearchBtn=document.getElementById("newSearchBtn"),this.clearFormBtn=document.getElementById("clearForm"),this.productGrid=document.getElementById("productGrid"),this.categoryFilter=document.getElementById("categoryFilter"),this.priceFilter=document.getElementById("priceFilter"),this.sortFilter=document.getElementById("sortFilter"),this.loadMoreBtn=document.getElementById("loadMoreBtn"),this.globalSearch=document.getElementById("globalSearch"),this.recommendBtn=document.getElementById("recommendBtn"),this.browseBtn=document.getElementById("browseBtn"),this.heroRecommendBtn=document.getElementById("heroRecommendBtn"),this.heroBrowseBtn=document.getElementById("heroBrowseBtn"),this.categoryCards=document.querySelectorAll(".category-card"),this.currentProducts=[],this.filteredProducts=[],this.currentPage=1,this.productsPerPage=12,this.initializeEventListeners(),this.loadAllProducts()}initializeEventListeners(){this.form.addEventListener("submit",e=>this.handleFormSubmit(e)),this.newSearchBtn.addEventListener("click",()=>this.resetForm()),this.clearFormBtn.addEventListener("click",()=>this.clearForm()),this.recommendBtn.addEventListener("click",()=>this.showRecommendationForm()),this.browseBtn.addEventListener("click",()=>this.showProductGrid()),this.heroRecommendBtn.addEventListener("click",()=>this.showRecommendationForm()),this.heroBrowseBtn.addEventListener("click",()=>this.showProductGrid()),this.categoryCards.forEach(e=>{e.addEventListener("click",e=>this.filterByCategory(e))}),this.categoryFilter.addEventListener("change",()=>this.applyFilters()),this.priceFilter.addEventListener("change",()=>this.applyFilters()),this.sortFilter.addEventListener("change",()=>this.applyFilters()),this.loadMoreBtn.addEventListener("click",()=>this.loadMoreProducts()),this.globalSearch.addEventListener("input",e=>this.handleGlobalSearch(e))}async handleFormSubmit(e){e.preventDefault();const t=new FormData(this.form),s=t.get("budget"),i=t.get("occasion"),r=t.get("recipientType"),n=t.get("ageRange"),o=t.get("likes"),a=t.get("dislikes");if(!s||s<10)this.showError("Please enter a valid budget (minimum $10)");else{this.showLoading();try{const e={likes:o?o.split(",").map(e=>e.trim()).filter(e=>e):[],dislikes:a?a.split(",").map(e=>e.trim()).filter(e=>e):[],ageRange:n},t=await fetch("/api/recommend",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({budget:parseFloat(s),preferences:e,occasion:i,recipientType:r})}),c=await t.json();c.success?this.displayResults(c.recommendations):this.showError(c.error||"Failed to get recommendations")}catch(e){console.error("Error:",e),this.showError("Failed to connect to the server. Please try again.")}}}showLoading(){this.form.style.display="none",this.resultsSection.classList.add("hidden"),this.loadingSection.classList.remove("hidden")}displayResults(e){if(this.loadingSection.classList.add("hidden"),this.resultsSection.classList.remove("hidden"),0===e.length)return this.giftsContainer.innerHTML='\n                <div class="no-results">\n                    <i class="fas fa-search" style="font-size: 3rem; color: #cbd5e0; margin-bottom: 1rem;"></i>\n                    <h3>No gifts found</h3>\n                    <p>Try adjusting your budget or preferences to find more options.</p>\n                </div>\n            ',void(this.resultsCount.textContent="No recommendations found");this.resultsCount.textContent=`Found ${e.length} perfect gift${1!==e.length?"s":""}`,this.giftsContainer.innerHTML=e.map(e=>this.createGiftCard(e)).join("")}createGiftCard(e){const t=e.tags.map(e=>`<span class="gift-tag">${e}</span>`).join(""),s=e.occasion.join(", ");return`\n            <div class="gift-card">\n                <div class="gift-header">\n                    <div>\n                        <div class="gift-name">${e.name}</div>\n                        <div class="gift-category">${e.category}</div>\n                    </div>\n                    <div class="gift-price">$${e.price.toFixed(2)}</div>\n                </div>\n                <div class="gift-description">${e.description}</div>\n                <div class="gift-tags">${t}</div>\n                <div class="gift-occasion">Perfect for: ${s}</div>\n            </div>\n        `}showError(e){this.loadingSection.classList.add("hidden"),this.resultsSection.classList.remove("hidden"),this.giftsContainer.innerHTML=`\n            <div class="error-message">\n                <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: #e53e3e; margin-bottom: 1rem;"></i>\n                <h3>Oops! Something went wrong</h3>\n                <p>${e}</p>\n                <button onclick="location.reload()" class="retry-btn" style="\n                    background: #e53e3e;\n                    color: white;\n                    border: none;\n                    padding: 0.75rem 1.5rem;\n                    border-radius: 8px;\n                    cursor: pointer;\n                    margin-top: 1rem;\n                ">Try Again</button>\n            </div>\n        `,this.resultsCount.textContent="Error occurred"}resetForm(){this.form.reset(),this.form.style.display="block",this.resultsSection.classList.add("hidden"),this.loadingSection.classList.add("hidden"),window.scrollTo({top:0,behavior:"smooth"})}clearForm(){this.form.reset(),document.getElementById("budget").focus()}handleNavigation(e){e.preventDefault();const t=e.target.getAttribute("href").substring(1);this.navLinks.forEach(e=>e.classList.remove("active")),e.target.classList.add("active"),Object.values(this.sections).forEach(e=>{e.classList.add("hidden")}),this.sections[t]&&this.sections[t].classList.remove("hidden"),this.sections[t].scrollIntoView({behavior:"smooth"})}handlePreset(e){const t={"birthday-male":{budget:100,occasion:"birthday",recipientType:"male",likes:"tech, sports, gadgets",dislikes:"",ageRange:"26-35"},"birthday-female":{budget:100,occasion:"birthday",recipientType:"female",likes:"beauty, fashion, jewelry",dislikes:"",ageRange:"26-35"},"holiday-family":{budget:50,occasion:"holiday",recipientType:"general",likes:"home, family, cozy",dislikes:"",ageRange:"36-55"},"tech-lover":{budget:200,occasion:"general",recipientType:"general",likes:"tech, gadgets, electronics, innovation",dislikes:"old-fashioned",ageRange:"18-45"},"fitness-buff":{budget:100,occasion:"general",recipientType:"general",likes:"fitness, sports, health, wellness",dislikes:"sedentary",ageRange:"20-50"},"book-worm":{budget:30,occasion:"general",recipientType:"general",likes:"books, reading, literature, learning",dislikes:"noise",ageRange:"25-65"}}[e.currentTarget.getAttribute("data-preset")];t&&(document.getElementById("budget").value=t.budget,document.getElementById("occasion").value=t.occasion,document.getElementById("recipientType").value=t.recipientType,document.getElementById("likes").value=t.likes,document.getElementById("dislikes").value=t.dislikes,document.getElementById("ageRange").value=t.ageRange,this.navLinks.forEach(e=>e.classList.remove("active")),document.querySelector('a[href="#search"]').classList.add("active"),Object.values(this.sections).forEach(e=>{e.classList.add("hidden")}),this.sections.search.classList.remove("hidden"),this.sections.search.scrollIntoView({behavior:"smooth"}))}async loadBrowseResults(){try{const e=await fetch("/api/gifts"),t=await e.json();if(t.success){let e=t.gifts;const s=this.categoryFilter.value,i=this.priceFilter.value;if(s&&(e=e.filter(e=>e.category===s)),i){const[t,s]=i.split("-").map(e=>"+"===e?1/0:parseInt(e));e=e.filter(e=>e.price>=t&&e.price<=s)}this.displayBrowseResults(e)}}catch(e){console.error("Error loading browse results:",e),this.browseResults.innerHTML="<p>Error loading gifts. Please try again.</p>"}}async loadAllProducts(){try{const e=await fetch("/api/gifts"),t=await e.json();t.success&&(this.currentProducts=t.gifts,this.filteredProducts=[...this.currentProducts],this.displayProducts())}catch(e){console.error("Error loading products:",e)}}displayProducts(){const e=this.currentPage*this.productsPerPage,t=this.filteredProducts.slice(0,e);this.productGrid.innerHTML=t.map(e=>this.createProductCard(e)).join(""),this.loadMoreBtn.style.display=e>=this.filteredProducts.length?"none":"block"}createProductCard(e){const t=e.tags.slice(0,3).map(e=>`<span class="product-tag">${e}</span>`).join("");return`\n            <div class="product-card" data-id="${e.id}">\n                <div class="product-image">\n                    <div class="product-badge">${e.category}</div>\n                    <i class="fas fa-gift"></i>\n                </div>\n                <div class="product-info">\n                    <div class="product-category">${e.category}</div>\n                    <div class="product-name">${e.name}</div>\n                    <div class="product-description">${e.description}</div>\n                    <div class="product-tags">${t}</div>\n                    <div class="product-footer">\n                        <div class="product-price">$${e.price.toFixed(2)}</div>\n                        <button class="add-to-cart" onclick="app.addToCart(${e.id})">\n                            <i class="fas fa-plus"></i>\n                            Add to Cart\n                        </button>\n                    </div>\n                </div>\n            </div>\n        `}showRecommendationForm(){document.getElementById("search").scrollIntoView({behavior:"smooth"})}showProductGrid(){document.querySelector(".featured-products").scrollIntoView({behavior:"smooth"})}filterByCategory(e){const t=e.currentTarget.getAttribute("data-category");this.categoryFilter.value=t,this.applyFilters(),this.showProductGrid()}applyFilters(){let e=[...this.currentProducts];const t=this.categoryFilter.value;t&&(e=e.filter(e=>e.category===t));const s=this.priceFilter.value;if(s){const[t,i]=s.split("-").map(e=>"+"===e?1/0:parseInt(e));e=e.filter(e=>e.price>=t&&e.price<=i)}switch(this.sortFilter.value){case"price-low":e.sort((e,t)=>e.price-t.price);break;case"price-high":e.sort((e,t)=>t.price-e.price);break;case"name":e.sort((e,t)=>e.name.localeCompare(t.name))}this.filteredProducts=e,this.currentPage=1,this.displayProducts()}loadMoreProducts(){this.currentPage++,this.displayProducts()}handleGlobalSearch(e){const t=e.target.value.toLowerCase();t.length<2?this.filteredProducts=[...this.currentProducts]:this.filteredProducts=this.currentProducts.filter(e=>e.name.toLowerCase().includes(t)||e.description.toLowerCase().includes(t)||e.tags.some(e=>e.toLowerCase().includes(t))||e.category.toLowerCase().includes(t)),this.currentPage=1,this.displayProducts()}addToCart(e){console.log("Added to cart:",e)}}let t;document.addEventListener("DOMContentLoaded",()=>{t=new e}),document.addEventListener("DOMContentLoaded",()=>{const e=document.createElement("style");e.textContent="\n        html {\n            scroll-behavior: smooth;\n        }\n        \n        .no-results, .error-message {\n            text-align: center;\n            padding: 3rem 1rem;\n            color: #718096;\n        }\n        \n        .no-results h3, .error-message h3 {\n            color: #4a5568;\n            margin-bottom: 0.5rem;\n        }\n        \n        .retry-btn:hover {\n            background: #c53030 !important;\n            transform: translateY(-2px);\n        }\n    ",document.head.appendChild(e)})})();